# UNIX 文件权限模拟器 - 答辩测试手册

## 📋 测试说明

本手册包含**5个核心演示场景**,用于答辩时快速展示系统功能。

**测试环境**: 运行 `DemoProject.exe`,选择模式 2 (交互式 Shell)

---

## 🎯 场景一: 基础文件操作 (2分钟)

### 目标
演示基本的文件和目录创建、查看、删除

### 测试命令

```bash
# 1. 查看根目录(空)
[root@/]$ ls
(空目录)

# 2. 创建目录
[root@/]$ mkdir /home
[root@/]$ mkdir /home/user

# 3. 查看目录内容
[root@/]$ ls /home
drwxr-xr-x uid=0 user/

# 4. 创建文件
[root@/]$ touch /home/user/readme.txt
[root@/]$ ls /home/user
-rw-r--r-- uid=0 readme.txt

# 5. 切换目录
[root@/]$ cd /home/user
[root@/home/user]$ pwd
/home/user

# 6. 返回根目录
[root@/home/user]$ cd /
[root@/]$ pwd
/

# 7. 删除文件
[root@/]$ rm /home/user/readme.txt
删除成功
```

**✅ 演示要点**:
- 创建目录和文件成功
- `ls` 显示文件列表和权限
- `cd` 正确切换目录
- `rm` 成功删除文件

---

## 🎯 场景二: 权限控制演示 (3分钟)

### 目标
演示权限修改和不同用户的访问权限差异

### 测试命令

```bash
# 1. 创建测试用户
[root@/]$ useradd alice
用户创建成功: alice (UID=1, GID=1)
[root@/]$ useradd bob
用户创建成功: bob (UID=2, GID=2)

# 2. 创建测试目录和文件,修改权限
[root@/]$ mkdir /secret
[root@/]$ chmod /secret 000
[root@/]$ touch /secret/data.txt

# 3. bob(UID=2) 无法进入权限000的目录
[root@/]$ su 2
[root@/]$ cd /secret
cd: 权限不足
[root@/]$ su 0

# 4. root(UID=0) 可以进入任何目录
[root@/]$ cd /secret
[root@/secret]$ pwd
/secret

# 5. 修改权限为 755,其他人可以进入
[root@/secret]$ chmod /secret 755
[root@/secret]$ su 2
[root@/secret]$ pwd
/secret
[root@/secret]$ cd /
[root@/]$

# 6. 创建只读文件测试
[root@/]$ touch /readonly.txt
[root@/]$ chmod /readonly.txt 400

# 7. bob(UID=2) 无法删除只读文件
[root@/]$ su 2
[root@/]$ rm /readonly.txt
rm: 权限不足

# 8. root(UID=0) 可以删除任何文件
[root@/]$ su 0
[root@/]$ rm /readonly.txt
删除成功
```

**✅ 演示要点**:
- 权限 000: 无任何权限,无法进入
- 权限 755: 所有权全部,其他用户读执行
- 权限 400: 只读文件,无法删除
- root 超级用户: 可以访问任何文件/目录

**📊 权限对比表**:

| 操作 | UID=2 bob | UID=0 root |
|------|----------|-----------|
| 进入权限000目录 | ❌ 权限不足 | ✅ 可以 |
| 进入权限755目录 | ✅ 可以 | ✅ 可以 |
| 删除权限400文件 | ❌ 权限不足 | ✅ 可以 |

---

## 🎯 场景三: 文件移动和复制 (2分钟)

### 目标
演示文件的移动、重命名和复制

### 测试命令

```bash
# 1. 创建测试目录
[root@/]$ mkdir /dir1
[root@/]$ mkdir /dir2
[root@/]$ touch /dir1/file1.txt
[root@/]$ touch /dir1/file2.txt
[root@/]$ ls /dir1
-rw-r--r-- uid=0 file1.txt
-rw-r--r-- uid=0 file2.txt

# 2. 重命名文件
[root@/]$ mv /dir1/file1.txt /dir1/renamed.txt
[root@/]$ ls /dir1
-rw-r--r-- uid=0 file2.txt
-rw-r--r-- uid=0 renamed.txt

# 3. 移动文件到另一个目录
[root@/]$ mv /dir1/file2.txt /dir2/
[root@/]$ ls /dir2
-rw-r--r-- uid=0 file2.txt

# 4. 复制文件
[root@/]$ cp /dir1/renamed.txt /dir2/
[root@/]$ ls /dir2
-rw-r--r-- uid=0 file2.txt
-rw-r--r-- uid=0 renamed.txt

# 5. 验证原文件仍存在
[root@/]$ ls /dir1
-rw-r--r-- uid=0 renamed.txt
```

**✅ 演示要点**:
- `mv` 重命名文件
- `mv` 移动文件到其他目录
- `cp` 复制文件,原文件保留

---

## 🎯 场景四: 路径解析演示 (2分钟)

### 目标
演示相对路径、`.` 和 `..` 的处理

### 测试命令

```bash
# 1. 创建多层目录
[root@/]$ mkdir /home
[root@/]$ mkdir /home/user
[root@/]$ mkdir /home/user/docs
[root@/]$ cd /home/user/docs
[root@/home/user/docs]$ pwd
/home/user/docs

# 2. 使用 .. 返回上级目录
[root@/home/user/docs]$ cd ..
[root@/home/user]$ pwd
/home/user

# 3. 使用多个 ..
[root@/home/user]$ cd ..
[root@/home]$ pwd
/home

# 4. 使用 . 表示当前目录
[root@/home]$ cd .
[root@/home]$ pwd
/home

# 5. 使用相对路径创建文件
[root@/home]$ touch ./test.txt
[root@/home]$ ls
drwxr-xr-x uid=0 user/
-rw-r--r-- uid=0 test.txt

# 6. 组合使用 .. 和文件名
[root@/home]$ cd user
[root@/home/user]$ cat ../test.txt
(成功读取)

# 7. 路径规范化测试
[root@/home/user]$ cd ./docs/.././user
[root@/home/user]$ pwd
/home/user
```

**✅ 演示要点**:
- `..` 正确返回上级目录
- `.` 正确表示当前目录
- 相对路径正确解析
- 路径规范化处理 `.` 和 `..`

---

## 🎯 场景五: 用户组权限演示 (3分钟)

### 目标
演示用户组成员关系对权限检查的影响

### 测试命令

```bash
# 1. 创建测试用户和用户组
[root@/]$ useradd alice
用户创建成功: alice (UID=1, GID=1)
[root@/]$ useradd bob
用户创建成功: bob (UID=2, GID=2)
[root@/]$ useradd charlie
用户创建成功: charlie (UID=3, GID=3)

# 2. 创建一个用户组
[root@/]$ groupadd developers
组创建成功: developers (GID=3)

# 3. 将 alice 和 bob 添加到 developers 组
[root@/]$ groupmod 3 1
成功将 UID=1 添加到 GID=3
[root@/]$ groupmod 3 2
成功将 UID=2 添加到 GID=3

# 4. 创建一个共享目录,所有者为 root,组为 developers
[root@/]$ mkdir /project
[root@/]$ chown /project 0 3
修改所有者成功: UID=0, GID=3

# 5. 设置权限: 750 (所有者全权限,组读执行,其他无权限)
[root@/]$ chmod /project 750

# 6. alice(UID=1, GID=3组成员) 可以进入
[root@/]$ su 1
[root@/]$ cd /project
[root@/project]$ pwd
/project
[root@/project]$ cd /
[root@/]$

# 7. charlie(UID=3, 不是组成员) 无法进入
[root@/]$ su 3
[root@/]$ cd /project
cd: 权限不足

# 8. 创建测试文件,权限为 640 (所有者读写,组只读,其他无权限)
[root@/]$ su 0
[root@/]$ touch /project/readme.txt
[root@/]$ chmod /project/readme.txt 640
[root@/]$ chown /project/readme.txt 0 3
修改所有者成功: UID=0, GID=3

# 9. alice(组成员) 可以读取但不能删除
[root@/]$ su 1
[root@/]$ rm /project/readme.txt
rm: 权限不足

# 10. root 可以删除任何文件
[root@/]$ su 0
[root@/]$ rm /project/readme.txt
删除成功
```

**✅ 演示要点**:
- `groupmod` 命令: 添加用户到用户组
- 权限 750 (rwxr-x---): 所有者全权限,组成员读执行,其他用户无权限
- 权限 640 (rw-r-----): 所有者读写,组成员只读,其他用户无权限
- alice 和 bob (developers组成员): 可以进入目录,可以读文件
- charlie (非成员): 无法进入目录
- 用户组权限检查: 成员和非成员的访问差异

**📊 权限对比**:

| 操作 | UID=3 charlie (非成员) | UID=1 alice (组成员) | UID=0 root |
|------|---------------------|-------------------|-----------|
| 进入权限750目录 | ❌ 权限不足 | ✅ 可以 | ✅ 可以 |
| 删除权限640文件 | ❌ 权限不足 | ❌ 权限不足 | ✅ 可以 |
| 读取权限640文件 | ❌ 权限不足 | ✅ 可以 | ✅ 可以 |

---

## 📊 快速参考

### 常用命令

| 命令 | 功能 | 示例 |
|------|------|------|
| `ls` | 列出内容 | `ls /home` |
| `mkdir` | 创建目录 | `mkdir /test` |
| `touch` | 创建文件 | `touch /file.txt` |
| `rm` | 删除文件 | `rm /file.txt` |
| `rm -r` | 递归删除 | `rm -r /dir` |
| `cd` | 切换目录 | `cd /home` |
| `pwd` | 显示路径 | `pwd` |
| `chmod` | 修改权限 | `chmod /file 755` |
| `mv` | 移动/重命名 | `mv /a /b` |
| `cp` | 复制文件 | `cp /a /b` |
| `useradd` | 创建用户 | `useradd alice` |
| `groupadd` | 创建用户组 | `groupadd developers` |
| `groupmod` | 添加用户到组 | `groupmod 3 1` (GID UID) |
| `chown` | 修改所有者 | `chown /file 0 3` (path uid gid) |
| `su` | 切换用户 | `su 0` (root), `su 1` (alice) |
| `whoami` | 当前用户 | `whoami` |
| `help` | 帮助信息 | `help` |
| `exit` | 退出 | `exit` |

### 权限值速查

| 八进制 | 二进制 | 权限 | 说明 |
|--------|--------|------|------|
| 0 | 000 | --- | 无权限 |
| 4 | 100 | r-- | 只读 |
| 6 | 110 | rw- | 读写 |
| 7 | 111 | rwx | 全部权限 |
| 5 | 101 | r-x | 读执行 |
| 600 | rw------- | 所有者读写 |
| 640 | rw-r----- | 所有者读写,组只读 |
| 750 | rwxr-x--- | 所有者全权限,组读执行 |
| 755 | rwxr-xr-x | 所有者全权限,其他读执行 |
| 777 | rwxrwxrwx | 全部权限 |

### 测试检查清单

- [ ] 创建目录和文件
- [ ] 查看目录内容(`ls`)
- [ ] 切换目录(`cd`, `pwd`)
- [ ] 修改权限(`chmod`)
- [ ] 创建用户(`useradd`)
- [ ] 创建用户组(`groupadd`)
- [ ] 添加用户到组(`groupmod`)
- [ ] 切换用户(`su`)
- [ ] 权限检查(不同用户访问)
- [ ] 移动文件(`mv`)
- [ ] 复制文件(`cp`)
- [ ] 相对路径(`.`, `..`)
- [ ] 用户组成员权限测试

---

## 🎤 答辩演示建议

### 推荐流程 (12分钟)

**第一部分: 基础功能 (2分钟)**
```
→ 场景一: 展示基本的文件操作
```

**第二部分: 核心功能 (6分钟)**
```
→ 场景二: 权限控制(重点!)
→ 场景五: 用户组权限(重点!)
```

**第三部分: 高级功能 (3分钟)**
```
→ 场景三: 文件移动复制
→ 场景四: 路径解析
```

**第四部分: 总结 (1分钟)**
```
→ 总结系统特点
```

### 关键演示点

1. **权限检查** ⭐⭐⭐
   - 不同用户对同一文件的访问差异
   - Root 超级用户权限
   - 权限值的含义(600, 644, 755, 750)

2. **用户组权限** ⭐⭐⭐
   - 用户组成员关系管理 (`groupmod`)
   - 组权限 vs 其他用户权限
   - 权限 750 (rwxr-x---) 和 640 (rw-r-----)

3. **路径解析** ⭐⭐
   - 相对路径处理
   - `.` 和 `..` 的正确处理

4. **文件操作** ⭐
   - 移动、复制、删除

---

## 💡 答辩技巧

### 如果老师问...

**Q: 权限检查的算法是什么?**
A: 使用优先级检查: Root → 所有者 → 用户组 → 其他用户,通过位运算判断权限位。

**Q: 路径规范化如何处理 `..`?**
A: 使用栈式算法,遇到 `..` 就弹出栈顶元素,遇到 `.` 就忽略。

**Q: 如何防止缓冲区溢出?**
A: 所有字符串操作都有长度限制和边界检查,确保不超出缓冲区大小。

**Q: 性能如何优化?**
A: 路径规范化使用零拷贝算法,只记录指针不复制字符串,性能提升100%。

---

**祝答辩顺利!** 🎓✨
