# 如何构建和运行测试程序

## 方法一: 使用 Visual Studio (推荐)

### 步骤 1: 打开解决方案
1. 在 Visual Studio 中打开 `UNIX_File_Permission_Simulator.slnx`

### 步骤 2: 配置项目依赖
1. 在解决方案资源管理器中,右键点击 `DemoProject`
2. 选择 "项目依赖项..."
3. 确保 `KernProject` 被勾选为依赖项

### 步骤 3: 设置 KernProject 链接
1. 右键点击 `DemoProject` > "属性"
2. 在 "链接器" > "常规" 中:
   - "附加库目录" 添加: `$(SolutionDir)$(Platform)\$(Configuration)`
3. 在 "链接器" > "输入" 中:
   - "附加依赖项" 添加: `KernProject.lib`

### 步骤 4: 构建项目
1. 在顶部工具栏选择配置: `Debug` 或 `Release`
2. 选择平台: `x64` (推荐) 或 `x86`
3. 点击菜单: "生成" > "生成解决方案" (或按 Ctrl+Shift+B)

### 步骤 5: 运行测试
1. 按 `F5` 开始调试
2. 或按 `Ctrl+F5` 运行但不调试

---

## 方法二: 使用 Developer Command Prompt

### 打开 Developer Command Prompt
1. 按 Win 键,搜索 "Developer Command Prompt for VS 2022"
2. 打开该命令提示符

### 构建并运行
```bash
cd d:\UNIX_File_Permission_Simulator

# 清理之前的构建
msbuild UNIX_File_Permission_Simulator.slnx /t:Clean /p:Configuration=Debug /p:Platform=x64

# 构建整个解决方案
msbuild UNIX_File_Permission_Simulator.slnx /p:Configuration=Debug /p:Platform=x64

# 运行测试程序
x64\Debug\DemoProject.exe
```

---

## 预期输出

如果一切正常,您应该看到以下输出:

```
========================================
UNIX 文件权限模拟器 - 用户管理测试
========================================

=== 测试1: 基本用户管理 ===
创建用户 root (uid=0, gid=0): 成功
创建用户 alice (uid=1001, gid=100): 成功
创建用户 bob (uid=1002, gid=100): 成功
创建用户 charlie (uid=1003, gid=101): 成功
再次创建 alice (应该失败): 失败: 用户已存在

查找用户测试:
找到用户: alice (UID=1001, GID=100)
通过名字找到用户: root (UID=0)
查找不存在的用户: 未找到 (正确)

当前用户总数: 4

=== 测试2: 基本用户组管理 ===
创建组 root (gid=0): 成功
创建组 developers (gid=100): 成功
创建组 managers (gid=101): 成功
再次创建 developers (应该失败): 失败: 组已存在

查找组测试:
找到组: developers (GID=100)
通过名字找到组: managers (GID=101)

当前组总数: 3

=== 测试3: 组成员管理 ===
添加 alice 到 developers 组: 成功
添加 bob 到 developers 组: 成功
添加 charlie 到 managers 组: 成功
再次添加 alice 到 developers (应该失败或已存在): 失败: 组已存在

检查成员关系:
alice 是否在 developers 组? 是
bob 是否在 developers 组? 是
charlie 是否在 developers 组? 否
root 是否在 developers 组? 否

移除 bob 从 developers 组: 成功
再次检查 bob 是否在 developers 组: 否
developers 组的成员数: 1

=== 测试4: 删除操作 ===
删除用户 charlie: 成功
用户总数: 3
验证 charlie 是否已删除: 已删除 (正确)

删除 managers 组: 成功
组总数: 2
验证 managers 组是否已删除: 已删除 (正确)

========================================
所有测试完成!
========================================
```

---

## 常见问题

### 错误: 无法打开包括文件: "user_manager.h"
**原因**: 项目依赖未正确设置
**解决**: 按照方法一步骤2设置项目依赖

### 错误: 无法解析的外部符号
**原因**: 未正确链接 KernProject.lib
**解决**: 按照方法一步骤3设置链接器依赖项

### 错误: 无法找到 KernProject.lib
**原因**: KernProject 未编译或路径错误
**解决**: 先构建 KernProject,再构建 DemoProject

---

## 测试覆盖范围

✅ 用户创建和删除
✅ 用户组创建和删除
✅ 通过UID/用户名查找用户
✅ 通过GID/组名查找组
✅ 添加/移除组成员
✅ 成员关系检查
✅ 重复创建检测
✅ 错误处理
